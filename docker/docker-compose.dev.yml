services:
  homepage:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    ports:
      - "82:80"
    volumes:
      # Mount source code for development
      - ..:/src
      - web_logs_dev:/var/log/nginx
      # Override nginx config for development (direct access, no Traefik)
      - ../docker/nginx-dev.conf:/etc/nginx/conf.d/default.conf
    environment:
      - HUGO_ENV=development
    restart: unless-stopped
    # Override command to watch for changes and log to volume
    command: sh -c "mkdir -p /var/log/nginx && nginx -g 'daemon off;' & cd /src && hugo server --bind 0.0.0.0 --port 8080 --buildDrafts --buildFuture 2>&1 | tee /var/log/nginx/hugo.log | node /src/scripts/format-logs.js"

volumes:
  web_logs_dev: